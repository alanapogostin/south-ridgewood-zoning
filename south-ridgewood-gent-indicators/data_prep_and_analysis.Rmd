---
title: "south-ridgewood-housing-indicators"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# install.packages(tidycensus)
# install.packages(tidyverse)

library(tidyverse)
library(tidycensus)


```

## Pulling in ACS indicators for the south ridgewood census block
```{r}
# Connecting to my API
census_api_key("4ce84da33024270337d2c7a57c4b2cbf6bc78f6c")

# Checking out the variable ID's
v9 <- load_variables(2019, "acs5", cache = TRUE)

## loading the 2019-2015 survey
census_19 <- get_acs(
  geography = "tract",
  state = "NY",
  county = (081),
  tract = c(553, 555, 557, 559),
  year = 2019,
  survey = "acs5",
  output = "wide",
  geometry = FALSE,
  variables = c(
    "pop" = "B01003_001",
    "gross_rent_med" = "B25064_001", # median gross rent
    "hh_inc_med" = "B19013_001", # median household income
    "rent_burden_med" = "B25071_001", # median rent burden
    "pov_pct" = "C17002_001", # poverty rate
    "hh_size_avg" = "B25010_001", # average hosehold size
    "occ_units" = "B25003_001", # total occupied units
    "occ_renter_units" = "B25003_003", # renter occupied units
    #"vac_forrent_units" = "B25004_002", # vacant units for rent
    "vac_rented_units" = "B25004_003", # vacant units rented
    "occ_owner"= "B07013_002" # owner occupied
  )
) %>%
  mutate(year = 2019) %>%
  filter(GEOID %in% c(36081055500,
                    36081055300,
                    36081055700,
                    36081055900))

```

```{r}
## loading the 2014-2010 survey ***NOT ALL THE CENSUS TRACTS ARE THERE**
census_14 <- get_acs(
  geography = "tract",
  state = "NY",
  county = (081),
  year = 2014,
  survey = "acs5",
  output = "wide",
  geometry = FALSE,
  variables = c(
    "pop" = "B01003_001",
    "gross_rent_med" = "B25064_001", # median gross rent
    "hh_inc_med" = "B19013_001", # median household income
    "rent_burden_med" = "B25071_001", # median rent burden
    "pov_pct" = "C17002_001", # poverty rate
    "hh_size_avg" = "B25010_001", # average hosehold size
    "occ_units" = "B25003_001", # total occupied units
    "occ_renter_units" = "B25003_003", # renter occupied units
    #"vac_forrent_units" = "B25004_002", # vacant units for rent
    "vac_rented_units" = "B25004_003", # vacant units rented
    "occ_owner"= "B07013_002" # owner occupied
  ))%>% mutate(year = 2014) %>%
  filter(GEOID %in% c(36081055500,
                    36081055300,
                    36081055700,
                    36081055900))
```
```{r}
## loading the 2009-2005 survey ***NOT ALL THE CENSUS TRACTS ARE THERE**
#v9 <- load_variables(20, "acs5", cache = TRUE)
census_09 <- get_acs(
  geography = "tract",
  state = "NY",
  county = (081),
  year = 2009,
  survey = "acs5",
  output = "wide",
  geometry = FALSE,
  variables = c(
    "pop" = "B01003_001",
    "gross_rent_med" = "B25064_001", # median gross rent
    "hh_inc_med" = "B19013_001", # median household income
    "rent_burden_med" = "B25071_001", # median rent burden
    "pov_pct" = "C17002_001", # poverty rate
    "hh_size_avg" = "B25010_001", # average hosehold size
    "occ_units" = "B25003_001", # total occupied units
    "occ_renter_units" = "B25003_003", # renter occupied units
    #"vac_forrent_units" = "B25004_002", # vacant units for rent
    "vac_rented_units" = "B25004_003", # vacant units rented
    "occ_owner"= "B25115_002" # owner occupied
  )) %>%
  mutate(
    year = 2009) %>%
  filter(GEOID %in% c(36081055500,
                    36081055300,
                    36081055700,
                    36081055900))
```
```{r}
# # Joining the Two ** CANT USE THIS YET
# census_10_19 <- census_19 %>% 
#   left_join(census_14, by = "GEOID") %>%
#   left_join(census_09, by = "GEOID") 
```
```{r}
# Joining the Two ** CANT USE THIS YET
census_ <-  census_19 %>% 
  bind_rows(census_14, census_09)

write.csv(census_,"/Users/alanapogostin/Desktop/Urban_Planning_Methods/south_ridgewood_census.csv", row.names = FALSE)
```
# 2015-2019 Data Wrangling
```{r}
rent_burden_indc <- census_ %>%
  select("year","gross_rent_medE", "hh_inc_medE", "rent_burden_medE") %>%
  group_by(year) %>%
  summarise(gross_rent_med_mean = mean(gross_rent_medE),
            hh_inc_med_mean = mean(hh_inc_medE),
            rent_burden_med = mean(rent_burden_medE),
            )
rent_burden_indc <- rent_burden_indc %>%
  mutate(gross_rent_med_mean_change = ((gross_rent_med_mean) - first(gross_rent_med_mean))/ first(gross_rent_med_mean) * 100)

```
# Rent Burden
```{r}
rent_burden_indc <- rent_burden_indc %>%
  mutate(gross_rent_med_mean_change = ((gross_rent_med_mean) - first(gross_rent_med_mean))/ first(gross_rent_med_mean) * 100)

```
# Population Change
```{r}
pop_change <- census_ %>%
  select("year","popE") %>%
  group_by(year) %>%
  summarise(pop_mean = mean(popE)
            )
gg_pop_change <- ggplot(pop_change, aes(x = year, y = pop_mean)) +
  geom_bar(stat="identity") +
  scale_y_continuous(n.breaks = 10) +
  # geom_text(aes(label=pov_pct_mean), vjust=-0.3, size=3.5)+
  labs(title = "Population of Southern Ridgewood",
       x = "Year",
       y = "Number of Residents") +
  theme_bw()
gg_pop_change
```

# Poverty
```{r}
poverty <- census_ %>%
  select("year", "pov_pctE", "occ_ownerE", "popE") %>%
  group_by(year) %>%
  summarise(pov_mean = mean(pov_pctE),
            pov_pct_mean = (pov_mean/100/100)
            )
gg_poverty <- ggplot(poverty, aes(x = year, y = pov_pct_mean)) +
  geom_bar(stat="identity") +
  scale_y_continuous(labels = scales::percent,
                     n.breaks = 10) +
  # geom_text(aes(label=pov_pct_mean), vjust=-0.3, size=3.5)+
  labs(title = "Poverty Rate in Southern Ridgewood",
       x = "Year",
       y = "Poverty Rate (%)") +
  theme_bw()
gg_poverty
```

# Gross Rent-------------------------------
```{r}
(https://www.bls.gov/data/inflation_calculator.htm)

gross_rent_change_df <- rent_burden_indc %>%
  summarize(rent_burden_indc)
```
# Ownership-----------------------------------
```{r}
owner_occ <- census_ %>%
  select("year","occ_unitsE", "occ_ownerE") %>%
  mutate(pct_owner_occ = (occ_ownerE/occ_unitsE)) %>%
  group_by(year) %>%
  summarize(pct_owner_occ_mean = mean(pct_owner_occ),
            occ_units_mean = mean(occ_unitsE),
            occ_ownerE = mean(occ_ownerE))

gg_owner_occ <- ggplot(owner_occ, aes(x = year, y = pct_owner_occ_mean)) +
  geom_bar(stat="identity") +
  scale_y_continuous(labels = scales::percent) +
   #geom_text(aes(label=pct_owner_occ_mean), vjust=-0.3, size=3.5)+
  labs(title = "Percent of total Occupied Units that are Owner Occupied",
       x = "Year",
       y = "Percent Owner Occupied") +
  theme_bw()
gg_owner_occ
```




